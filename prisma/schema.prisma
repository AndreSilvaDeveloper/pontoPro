generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // Ou "sqlite" se estiver usando local
  url      = env("DATABASE_URL")
}

model Empresa {
  id            String    @id @default(cuid())
  nome          String
  cnpj          String?
  criadoEm      DateTime  @default(now())
  
  // Configurações do SaaS e do App
  configuracoes Json?     // Ex: { "bloquearForaDoRaio": true, "exigirFoto": true }
  status        String    @default("ATIVO") // "ATIVO", "BLOQUEADO"
  
  usuarios      Usuario[]
  feriados      Feriado[]
}

model Usuario {
  id            String    @id @default(cuid())
  nome          String
  email         String    @unique
  
  
  senha      String    
  
  tituloCargo   String?
  
  // Biometria e Regras
  fotoPerfilUrl String?   
  jornada       Json?     
  assinaturaUrl String?
  
  // Controle
  cargo         String    @default("FUNCIONARIO") // ADMIN, SUPER_ADMIN, FUNCIONARIO
  deveTrocarSenha Boolean @default(false)
  
  // Vínculo
  empresaId     String?   
  empresa       Empresa?  @relation(fields: [empresaId], references: [id])

  // Geofencing Avançado
  latitudeBase  Float     @default(0)
  longitudeBase Float     @default(0)
  raioPermitido Int       @default(100)
  pontoLivre    Boolean   @default(false) 
  locaisAdicionais Json?

  // Relacionamentos
  pontos        Ponto[]
  ausencias     Ausencia[]
  solicitacoes  SolicitacaoAjuste[] 

  criadoEm      DateTime @default(now())
}

model Ponto {
  id        String   @id @default(cuid())
  dataHora  DateTime @default(now())
  latitude  Float
  longitude Float
  endereco  String?
  fotoUrl   String?
  tipo      String   @default("NORMAL")
  
  // Campo para motivo de edição do Admin
  descricao String?

  usuarioId String
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  solicitacoes SolicitacaoAjuste[]
}

model SolicitacaoAjuste {
  id          String   @id @default(cuid())
  novoHorario DateTime
  motivo      String
  status      String   @default("PENDENTE") 
  
  // Tipo do ponto (ENTRADA, SAIDA) para quando for inclusão de ponto esquecido
  tipo        String?  

  usuarioId   String
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  // Opcional: Se for ajuste de um ponto existente
  pontoId     String?  
  ponto       Ponto?   @relation(fields: [pontoId], references: [id], onDelete: Cascade)

  criadoEm    DateTime @default(now())
}

model Ausencia {
  id             String   @id @default(cuid())
  dataInicio     DateTime
  dataFim        DateTime
  tipo           String   // ATESTADO, FERIAS, FALTA_JUSTIFICADA
  motivo         String
  comprovanteUrl String?  
  status         String   @default("PENDENTE") 
  
  usuarioId      String
  usuario        Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  criadoEm       DateTime @default(now())
}

model Feriado {
  id        String   @id @default(cuid())
  data      DateTime
  nome      String   
  
  empresaId String?
  empresa   Empresa? @relation(fields: [empresaId], references: [id])

  criadoEm  DateTime @default(now())
}

model LogAuditoria {
  id        String   @id @default(cuid())
  dataHora  DateTime @default(now())
  acao      String   
  detalhes  String   
  
  adminNome String   
  adminId   String   
  empresaId String   
}